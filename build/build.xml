<?xml version="1.0" encoding="UTF-8"?>

<project name="Spam Guard" default="build">

    <property name="jsPath" value="../resources/js/" />
    <property name="cssPath" value="../resources/css/" />
    <property name="minPath" value="../resources/min/" />
    <property name="pluginVersion" value="v0.5.0" />

    <target name="clean">
        <echo msg="Running cleaning task..." />
        <delete file="${minPath}spamguard.js" verbose="false" failonerror="false" />
        <delete file="${minPath}spamguard.css" verbose="false" failonerror="false" />
    </target>

    <target name="concatenate" depends="clean">
        <echo msg="Combining JS and CSS..." />
        <append destfile="${minPath}spamguard.js">
            <filelist dir="${jsPath}" listfile="js.txt" />
        </append>
        <append destfile="${minPath}spamguard.css">
            <filelist dir="${cssPath}" listfile="css.txt" />
        </append>
    </target>

    <target name="minify" depends="concatenate">
        <echo msg="Minifying combined sources..." />
        <exec command="java -jar YUI2.4.8.jar ${minPath}spamguard.js -o ${minPath}spamguard.js" />
        <exec command="java -jar YUI2.4.8.jar ${minPath}spamguard.css -o ${minPath}spamguard.css" />
    </target>

    <target name="build" depends="minify">
        <echo msg="Finishing up..." />
    </target>

    <target name="release">
        <echo msg="Preparing release distro..." />
        <zip destfile="spamguard.${pluginVersion}.zip">
            <fileset dir="../../">
                <include name="spamguard/" />
                <exclude name="spamguard/build/" />
                <exclude name="spamguard/.git/" />
                <exclude name="spamguard/.idea/" />
                <exclude name="spamguard/.gitignore" />
            </fileset>
        </zip>
        <echo msg="Release .zip has been created!" />
    </target>

</project>
